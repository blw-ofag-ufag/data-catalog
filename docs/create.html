<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic JSON Form</title>
  <!-- Include Bootstrap CSS for styling -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<body>
  <div class="container">
    <h1>Dataset Metadata Form</h1>
    <!-- Form will be rendered here -->
    <form id="my-form"></form>
    <!-- Container to display the generated JSON -->
    <h2>Generated JSON</h2>
    <pre id="result"></pre>
  </div>

  <!-- Include necessary libraries -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://underscorejs.org/underscore-min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/jsonform/jsonform@2.2.5/lib/jsonform.js"></script>

  <script>
    $(document).ready(function() {
      // URL of the external JSON schema
      var schemaUrl = 'https://raw.githubusercontent.com/blw-ofag-ufag/data-catalog/refs/heads/main/docs/forms.json';

      // Fetch the external schema
      $.getJSON(schemaUrl, function(data) {
        // Add submit button to the form definition if not present
        if (!data.form.some(item => item.type === 'actions')) {
          data.form.push({
            type: 'actions',
            items: [
              {
                type: 'submit',
                value: 'Submit'
              }
            ]
          });
        }

        // Initialize the form
        $('#my-form').jsonForm({
          schema: data.schema,
          form: data.form,
          onSubmit: function (errors, values) {
            if (errors) {
              alert('Please correct the errors in the form.');
            } else {
              // Display the generated JSON in the <pre> element
              $('#result').text(JSON.stringify(values, null, 2));
            }
          }
        });
      }).fail(function() {
        alert('Failed to load the schema. Please check the URL and try again.');
      });
    });
  </script>
</body>
</html>
