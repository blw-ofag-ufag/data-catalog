"use strict";(self.webpackChunkDigiAgriFoodDB=self.webpackChunkDigiAgriFoodDB||[]).push([[796],{3796:(q,K,f)=>{f.r(K),f.d(K,{diagram:()=>V});var B,M=f(2339),N=(f(9717),f(9615),f(7447),f(1924),f(9639),f(8828),f(1403),f(5011)),t=f(3721),S=f(9266),k=f(315),A=f(8802),U=(0,t.K2)(e=>e.append("circle").attr("class","start-state").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit),"drawStartState"),W=(0,t.K2)(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.D7)().state.textHeight).attr("class","divider").attr("x2",2*(0,t.D7)().state.textHeight).attr("y1",0).attr("y2",0),"drawDivider"),C=(0,t.K2)((e,i)=>{const s=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+2*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),g=s.node().getBBox();return e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",g.width+2*(0,t.D7)().state.padding).attr("height",g.height+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),s},"drawSimpleState"),H=(0,t.K2)((e,i)=>{const s=(0,t.K2)(function(h,E,_){const w=h.append("tspan").attr("x",2*(0,t.D7)().state.padding).text(E);_||w.attr("dy",(0,t.D7)().state.textHeight)},"addTspan"),r=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+1.3*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),l=r.height,x=e.append("text").attr("x",(0,t.D7)().state.padding).attr("y",l+.4*(0,t.D7)().state.padding+(0,t.D7)().state.dividerMargin+(0,t.D7)().state.textHeight).attr("class","state-description");let a=!0,d=!0;i.descriptions.forEach(function(h){a||(s(x,h,d),d=!1),a=!1});const u=e.append("line").attr("x1",(0,t.D7)().state.padding).attr("y1",(0,t.D7)().state.padding+l+(0,t.D7)().state.dividerMargin/2).attr("y2",(0,t.D7)().state.padding+l+(0,t.D7)().state.dividerMargin/2).attr("class","descr-divider"),p=x.node().getBBox(),o=Math.max(p.width,r.width);return u.attr("x2",o+3*(0,t.D7)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",o+2*(0,t.D7)().state.padding).attr("height",p.height+l+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),e},"drawDescrState"),z=(0,t.K2)((e,i,s)=>{const g=(0,t.D7)().state.padding,r=2*(0,t.D7)().state.padding,l=e.node().getBBox(),x=l.width,a=l.x,d=e.append("text").attr("x",0).attr("y",(0,t.D7)().state.titleShift).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),p=d.node().getBBox().width+r;let h,o=Math.max(p,x);o===x&&(o+=r);const E=e.node().getBBox();h=a-g,p>x&&(h=(x-o)/2+g),Math.abs(a-E.x)<g&&p>x&&(h=a-(p-x)/2);const _=1-(0,t.D7)().state.textHeight;return e.insert("rect",":first-child").attr("x",h).attr("y",_).attr("class",s?"alt-composit":"composit").attr("width",o).attr("height",E.height+(0,t.D7)().state.textHeight+(0,t.D7)().state.titleShift+1).attr("rx","0"),d.attr("x",h+g),p<=x&&d.attr("x",a+(o-r)/2-p/2+g),e.insert("rect",":first-child").attr("x",h).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",o).attr("height",3*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e.insert("rect",":first-child").attr("x",h).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",o).attr("height",E.height+3+2*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e},"addTitleAndBox"),I=(0,t.K2)(e=>(e.append("circle").attr("class","end-state-outer").attr("r",(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2)),"drawEndState"),F=(0,t.K2)((e,i)=>{let s=(0,t.D7)().state.forkWidth,g=(0,t.D7)().state.forkHeight;if(i.parentId){let r=s;s=g,g=r}return e.append("rect").style("stroke","black").style("fill","black").attr("width",s).attr("height",g).attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding)},"drawForkJoinState"),j=(0,t.K2)((e,i,s,g)=>{let r=0;const l=g.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let x=e.replace(/\r\n/g,"<br/>");x=x.replace(/\n/g,"<br/>");const a=x.split(t.Y2.lineBreakRegex);let d=1.25*(0,t.D7)().state.noteMargin;for(const u of a){const p=u.trim();if(p.length>0){const o=l.append("tspan");o.text(p),0===d&&(d+=o.node().getBBox().height),r+=d,o.attr("x",i+(0,t.D7)().state.noteMargin),o.attr("y",s+r+1.25*(0,t.D7)().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:r}},"_drawLongText"),G=(0,t.K2)((e,i)=>{i.attr("class","state-note");const s=i.append("rect").attr("x",0).attr("y",(0,t.D7)().state.padding),g=i.append("g"),{textWidth:r,textHeight:l}=j(e,0,0,g);return s.attr("height",l+2*(0,t.D7)().state.noteMargin),s.attr("width",r+2*(0,t.D7)().state.noteMargin),s},"drawNote"),T=(0,t.K2)(function(e,i){const s=i.id,g={id:s,label:i.id,width:0,height:0},r=e.append("g").attr("id",s).attr("class","stateGroup");"start"===i.type&&U(r),"end"===i.type&&I(r),("fork"===i.type||"join"===i.type)&&F(r,i),"note"===i.type&&G(i.note.text,r),"divider"===i.type&&W(r),"default"===i.type&&0===i.descriptions.length&&C(r,i),"default"===i.type&&i.descriptions.length>0&&H(r,i);const l=r.node().getBBox();return g.width=l.width+2*(0,t.D7)().state.padding,g.height=l.height+2*(0,t.D7)().state.padding,g},"drawState"),L=0,Y=(0,t.K2)(function(e,i,s){const g=(0,t.K2)(function(d){switch(d){case M.u4.relationType.AGGREGATION:return"aggregation";case M.u4.relationType.EXTENSION:return"extension";case M.u4.relationType.COMPOSITION:return"composition";case M.u4.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(d=>!Number.isNaN(d.y));const r=i.points,l=(0,S.n8j)().x(function(d){return d.x}).y(function(d){return d.y}).curve(S.qrM),x=e.append("path").attr("d",l(r)).attr("id","edge"+L).attr("class","transition");let a="";if((0,t.D7)().state.arrowMarkerAbsolute&&(a=(0,t.ID)(!0)),x.attr("marker-end","url("+a+"#"+g(M.u4.relationType.DEPENDENCY)+"End)"),void 0!==s.title){const d=e.append("g").attr("class","stateLabel"),{x:u,y:p}=N._K.calcLabelPosition(i.points),o=t.Y2.getRows(s.title);let h=0;const E=[];let _=0,w=0;for(let n=0;n<=o.length;n++){const D=d.append("text").attr("text-anchor","middle").text(o[n]).attr("x",u).attr("y",p+h),c=D.node().getBBox();_=Math.max(_,c.width),w=Math.min(w,c.x),t.Rm.info(c.x,u,p+h),0===h&&(h=D.node().getBBox().height,t.Rm.info("Title height",h,p)),E.push(D)}let v=h*o.length;if(o.length>1){const n=(o.length-1)*h*.5;E.forEach((D,c)=>D.attr("y",p+c*h-n)),v=h*o.length}const P=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",u-_/2-(0,t.D7)().state.padding/2).attr("y",p-v/2-(0,t.D7)().state.padding/2-3.5).attr("width",_+(0,t.D7)().state.padding).attr("height",v+(0,t.D7)().state.padding),t.Rm.info(P)}L++},"drawEdge"),b={},J=(0,t.K2)(function(){},"setConf"),X=(0,t.K2)(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),Z=(0,t.K2)(function(e,i,s,g){B=(0,t.D7)().state;const r=(0,t.D7)().securityLevel;let l;"sandbox"===r&&(l=(0,S.Ltv)("#i"+i));const x=(0,S.Ltv)("sandbox"===r?l.nodes()[0].contentDocument.body:"body"),a="sandbox"===r?l.nodes()[0].contentDocument:document;t.Rm.debug("Rendering diagram "+e);const d=x.select(`[id='${i}']`);X(d);const u=g.db.getRootDoc();O(u,d,void 0,!1,x,a,g);const p=B.padding,o=d.node().getBBox(),h=o.width+2*p,E=o.height+2*p;(0,t.a$)(d,E,1.75*h,B.useMaxWidth),d.attr("viewBox",`${o.x-B.padding}  ${o.y-B.padding} `+h+" "+E)},"draw"),$=(0,t.K2)(e=>e?e.length*B.fontSizeFactor:1,"getLabelWidth"),O=(0,t.K2)((e,i,s,g,r,l,x)=>{const a=new A.T({compound:!0,multigraph:!0});let d,u=!0;for(d=0;d<e.length;d++)if("relation"===e[d].stmt){u=!1;break}a.setGraph(s?{rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:u?1:B.edgeLengthFactor,nodeSep:u?1:50,isMultiGraph:!0}:{rankdir:"TB",multigraph:!0,compound:!0,ranksep:u?1:B.edgeLengthFactor,nodeSep:u?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const p=x.db.getStates(),o=x.db.getRelations(),h=Object.keys(p);for(const n of h){const D=p[n];let c;if(s&&(D.parentId=s),D.doc){let y=i.append("g").attr("id",D.id).attr("class","stateGroup");c=O(D.doc,y,D.id,!g,r,l,x);{y=z(y,D,g);let m=y.node().getBBox();c.width=m.width,c.height=m.height+B.padding/2,b[D.id]={y:B.compositTitleSize}}}else c=T(i,D,a);if(D.note){const m=T(i,{descriptions:[],id:D.id+"-note",note:D.note,type:"note"},a);"left of"===D.note.position?(a.setNode(c.id+"-note",m),a.setNode(c.id,c)):(a.setNode(c.id,c),a.setNode(c.id+"-note",m)),a.setParent(c.id,c.id+"-group"),a.setParent(c.id+"-note",c.id+"-group")}else a.setNode(c.id,c)}t.Rm.debug("Count=",a.nodeCount(),a);let _=0;o.forEach(function(n){_++,t.Rm.debug("Setting edge",n),a.setEdge(n.id1,n.id2,{relation:n,width:$(n.title),height:B.labelHeight*t.Y2.getRows(n.title).length,labelpos:"c"},"id"+_)}),(0,k.Zp)(a),t.Rm.debug("Graph after layout",a.nodes());const w=i.node();a.nodes().forEach(function(n){void 0!==n&&void 0!==a.node(n)?(t.Rm.warn("Node "+n+": "+JSON.stringify(a.node(n))),r.select("#"+w.id+" #"+n).attr("transform","translate("+(a.node(n).x-a.node(n).width/2)+","+(a.node(n).y+(b[n]?b[n].y:0)-a.node(n).height/2)+" )"),r.select("#"+w.id+" #"+n).attr("data-x-shift",a.node(n).x-a.node(n).width/2),l.querySelectorAll("#"+w.id+" #"+n+" .divider").forEach(c=>{const y=c.parentElement;let m=0,R=0;y&&(y.parentElement&&(m=y.parentElement.getBBox().width),R=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(R)&&(R=0)),c.setAttribute("x1",0-R+8),c.setAttribute("x2",m-R-8)})):t.Rm.debug("No Node "+n+": "+JSON.stringify(a.node(n)))});let v=w.getBBox();a.edges().forEach(function(n){void 0!==n&&void 0!==a.edge(n)&&(t.Rm.debug("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(a.edge(n))),Y(i,a.edge(n),a.edge(n).relation))}),v=w.getBBox();const P={id:s||"root",label:s||"root",width:0,height:0};return P.width=v.width+2*B.padding,P.height=v.height+2*B.padding,t.Rm.debug("Doc rendered",P,a),P},"renderDoc"),Q={setConf:J,draw:Z},V={parser:M.Zk,get db(){return new M.u4(1)},renderer:Q,styles:M.tM,init:(0,t.K2)(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")}}}]);